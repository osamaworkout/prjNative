<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ุตูุญุฉ ุงูุทูุจุงุช</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../Assets/Images/favicon_io/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="../Assets/Images/favicon_io/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="../Assets/Images/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../Assets/Images/favicon_io/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../Assets/Images/favicon_io/apple-touch-icon.png">
    <link rel="manifest" href="../Assets/Images/favicon_io/site.webmanifest">

    <link rel="stylesheet" href="../../Assets/Styles/orderList.css" />
  </head>
  <body>
    <!-- Header with filter and refresh buttons -->
    <div class="page-header">
      <h1 class="page-title">ุฅุฏุงุฑุฉ ุงูุทูุจุงุช</h1>
      <div class="header-actions">
        <button class="header-btn" onclick="toggleFilterMenu()">
          <span class="icon">๐</span>
          <span>ููุชุฑ</span>
        </button>
        <button class="header-btn" onclick="refreshRequests()">
          <span class="icon">๐</span>
          <span>ุชุญุฏูุซ</span>
        </button>
        <div id="filterMenu" class="dropdown hidden">
          <button onclick="showDateInput()">ุญุณุจ ุงูุชุงุฑูุฎ</button><br />
          <input
            type="date"
            id="filterDate"
            class="hidden"
            onchange="filterByExactDate(this.value)"
          />
          <button onclick="showStatusOptions()">ุญุณุจ ุงูุญุงูุฉ</button>
          <div id="statusOptions" class="hidden">
            <select onchange="filterByStatus(this.value)">
              <option value="">ุงุฎุชุฑ ุงูุญุงูุฉ</option>
              <option value="ููุจูู">ููุจูู</option>
              <option value="ูุฑููุถ">ูุฑููุถ</option>
              <option value="ููุฏ ุงูุงูุชุธุงุฑ">ููุฏ ุงูุงูุชุธุงุฑ</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Application Cards Section -->
    <div class="applications-section">
      <div class="section-header">
        <h2>ุฃููุงุน ุงูุทูุจุงุช</h2>
        <p>ุงุฎุชุฑ ููุน ุงูุทูุจ ุงูุฐู ุชุฑูุฏ ุฅุฏุงุฑุชู</p>
      </div>
      
      <div class="applications-grid">
        <div class="application-card" id="purchaseOrder" onclick="">
          <div class="card-icon">๐</div>
          <h3 class="card-title">ุฅุฐู ุงูุดุฑุงุก</h3>
          <p class="card-description">ุฅุฏุงุฑุฉ ุทูุจุงุช ุงูุดุฑุงุก ูุงููุฎุงุฒู</p>
          <div class="card-badge">ูุฑูุจุงู</div>
        </div>

        <div class="application-card" id="payOrder" onclick="">
          <div class="card-icon">๐ฐ</div>
          <h3 class="card-title">ุฅุฐู ุงูุตุฑู</h3>
          <p class="card-description">ุฅุฏุงุฑุฉ ุทูุจุงุช ุงูุตุฑู ุงููุงูู</p>
          <div class="card-badge">ูุฑูุจุงู</div>
        </div>

        <div class="application-card" id="maintananceOrder" onclick="">
          <div class="card-icon">๐ง</div>
          <h3 class="card-title">ุฅุฐู ุงูุตูุงูุฉ</h3>
          <p class="card-description">ุฅุฏุงุฑุฉ ุทูุจุงุช ุตูุงูุฉ ุงููุฑูุจุงุช</p>
          <div class="card-badge">ูุฑูุจุงู</div>
        </div>

        <div class="application-card" id="missionOrder" onclick="">
          <div class="card-icon">๐</div>
          <h3 class="card-title">ุทูุจ ูุฃููุฑูุฉ</h3>
          <p class="card-description">ุฅุฏุงุฑุฉ ุทูุจุงุช ุงููุฃููุฑูุงุช ุงูุฑุณููุฉ</p>
          <div class="card-badge">ูุฑูุจุงู</div>
        </div>

        <div class="application-card active" id="jobOrder">
          <div class="card-icon">โ๏ธ</div>
          <h3 class="card-title">ุฃูุงูุฑ ุงูุดุบู</h3>
          <p class="card-description">ุฅุฏุงุฑุฉ ุฃูุงูุฑ ุงูุดุบู ูุงูููุงู</p>
          <div class="card-badge active">ูุชุงุญ</div>
        </div>
      </div>
    </div>

    <!-- Request List -->
    <div id="request-list" class="space-y-2"></div>

    <!-- Popup -->
    <div id="popup" class="popup hidden">
      <div class="popup-content">
        <h2 class="text-gray-600 text-sm">ุงุณู ุงูุทูุจ</h2>
        <p id="popup-date"></p>
        <h3>ุฑูู ุงููุณูุณู</h3>
        <p id="popup-id"></p>
        <h4>ุงุณู ุงูุดุฎุต</h4>
        <div style="border-top: 1px solid #ccc; margin: 16px 0"></div>
        <div class="flex-between" style="text-align: right">
          <div>
            <p>ุงููุทุนุฉ: ุงุณู ุงููุทุนุฉ</p>
            <p>ุงููุตู: ูุตู ุงููุทุนุฉ</p>
            <p>ุงููููุฉ: ุงููููุฉ</p>
          </div>
          <div>
            <p>ุงูุญุงูุฉ:</p>
            <span id="popup-status" class="badge"></span>
          </div>
        </div>
        <div class="flex-between" style="margin-top: 16px">
          <button class="button-accepted" onclick="closePopup()">ููุงููุฉ</button>
          <button class="button-rejected" onclick="closePopup()">ุฑูุถ</button>
        </div>
      </div>
    </div>
    <!-- Job Order Popup -->
    <div id="jobOrderPopup" class="popup hidden">
      <div
        class="popup-content"
        style="width: 90%; max-height: 80vh; overflow-y: auto"
      >
        <div class="flex-between">
          <h2>ุฃูุงูุฑ ุงูุดุบู</h2>
          <button onclick="closeJobOrderPopup()">โ</button>
        </div>
        <div style="margin-bottom: 12px; text-align: left">
          <button class="button" onclick="openAddJobOrderForm()">
            โ ุฅุถุงูุฉ ุฃูุฑ ุดุบู
          </button>
        </div>
        <div id="jobOrdersContainer" class="space-y-2"></div>
      </div>
    </div>

    <!-- Add/Edit Job Order Form -->
    <div id="addJobOrderPopup" class="popup hidden">
      <div class="popup-content job-order-form">
        <div class="form-header">
          <h2>ุฃูุฑ ุดุบู ุฌุฏูุฏ</h2>
          <button type="button" class="close-btn" onclick="closeAddJobOrderForm()">
            โ
          </button>
        </div>
        
        <form id="jobOrderForm" onsubmit="submitJobOrder(event)">
          <!-- Basic Information Section -->
          <div class="form-section">
            <h3 class="section-title">ูุนูููุงุช ุฃุณุงุณูุฉ</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="orderId">ุฑูู ุงูุฃูุฑ</label>
                <input type="number" id="orderId" />
              </div>
              <div class="form-group">
                <label for="applicationId">ุฑูู ุงูุทูุจ</label>
                <input type="number" id="applicationId" />
              </div>
              <div class="form-group">
                <label for="status">ุงูุญุงูุฉ</label>
                <select id="status" required disabled>
                  <option value="">ุงุฎุชุฑ ุงูุญุงูุฉ</option>
                  <option value="1">ูุงุฏูุฉ</option>
                  <option value="2">ููุชููุฉ</option>
                  <option value="3">ููุฏ ุงูุนูู</option>
                  <option value="4">ููุบู</option>
                </select>
              </div>
              <div class="form-group">
                <label for="applicationType">ููุน ุงูุทูุจ</label>
                <select id="applicationType" required>
                  <option value="">ุงุฎุชุฑ ููุน ุงูุทูุจ</option>
                  <option value="0">ุดุฑุงุก</option>
                  <option value="1">ุตุฑู</option>
                  <option value="2">ุตูุงูุฉ</option>
                  <option value="3">ูุฃููุฑูุฉ</option>
                  <option value="4">ุฃูุฑ ุดุบู</option>
                </select>
              </div>
              <div class="form-group full-width">
                <label for="applicationDescription">ูุตู ุงูุทูุจ</label>
                <textarea id="applicationDescription" required rows="3"></textarea>
              </div>
              <div class="form-group">
                <label for="createdByUserID">ุฑูู ุงููุณุชุฎุฏู</label>
                <input type="number" id="createdByUserID" />
              </div>
            </div>
          </div>

          <!-- Vehicle & Driver Section -->
          <div class="form-section">
            <h3 class="section-title">ูุนูููุงุช ุงูุณูุงุฑุฉ ูุงูุณุงุฆู</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="vehicleId">ุงูุณูุงุฑุฉ</label>
                <select id="vehicleId" required>
                  <option value="">ุงุฎุชุฑ ุงูุณูุงุฑุฉ</option>
                  <!-- Options will be populated dynamically -->
                </select>
              </div>
              <div class="form-group">
                <label for="driverId">ุงูุณุงุฆู</label>
                <select id="driverId" required>
                  <option value="">ุงุฎุชุฑ ุงูุณุงุฆู</option>
                  <!-- Options will be populated dynamically -->
                </select>
              </div>
              <div class="form-group full-width">
                <label for="destination">ุงููุฌูุฉ</label>
                <input type="text" id="destination" required />
              </div>
            </div>
          </div>

          <!-- Date & Time Section -->
          <div class="form-section">
            <h3 class="section-title">ุงูุชูููุช</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="startDate">ุชุงุฑูุฎ ุงูุจุฏุงูุฉ</label>
                <input type="date" id="startDate" required readonly />
              </div>
              <div class="form-group">
                <label for="startTime">ููุช ุงูุจุฏุงูุฉ</label>
                <input type="time" id="startTime" required />
              </div>
              <div class="form-group">
                <label for="endDate">ุชุงุฑูุฎ ุงูููุงูุฉ</label>
                <input type="date" id="endDate" required readonly />
              </div>
              <div class="form-group">
                <label for="endTime">ููุช ุงูููุงูุฉ</label>
                <input type="time" id="endTime" required />
              </div>
            </div>
          </div>

          <!-- Odometer Section -->
          <div class="form-section">
            <h3 class="section-title">ูุฑุงุกุฉ ุงูุนุฏุงุฏ</h3>
            <div class="form-grid">
              <div class="form-group">
                <label for="odometerBefore">ุนุฏุงุฏ ูุจู</label>
                <input type="number" id="odometerBefore" required />
              </div>
              <div class="form-group">
                <label for="odometerAfter">ุนุฏุงุฏ ุจุนุฏ</label>
                <input type="number" id="odometerAfter" required />
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="form-actions">
            <button class="btn btn-primary" type="submit">
              <span>๐พ</span> ุญูุธ
            </button>
            <button class="btn btn-secondary" type="button" onclick="closeAddJobOrderForm()">
              <span>โ</span> ุฅูุบุงุก
            </button>
          </div>
        </form>
      </div>
    </div>
    <script src="../../Java script/orderList.js"></script>
    <script>
      // Handle role-based access for application cards
      document.addEventListener("DOMContentLoaded", function() {
        const userRole = localStorage.getItem("userRole");
        
        // Define which roles can access which applications
        const rolePermissions = {
          // Arabic role names
          "ุฃุฏูู": ["jobOrder", "purchaseOrder", "payOrder", "maintananceOrder", "missionOrder"],
          "ุณูุฑุชุงุฑูุฉ": ["jobOrder", "missionOrder"],
          "ูุดุฑู ุฅุฏุงุฑู": ["jobOrder", "purchaseOrder", "payOrder"],
          "ูุดุฑู ููู": ["jobOrder", "maintananceOrder"],
          "ูุดุฑู ุนุงู": ["jobOrder", "purchaseOrder", "payOrder", "maintananceOrder", "missionOrder"],
          "ุณุงุฆู": [],
          "ูุฑุงูุจ": ["jobOrder"],
          
          // English role names (for compatibility)
          "Admin": ["jobOrder", "purchaseOrder", "payOrder", "maintananceOrder", "missionOrder"],
          "SuperUser": ["jobOrder", "purchaseOrder", "payOrder", "maintananceOrder", "missionOrder"],
          "Secretary": ["jobOrder", "missionOrder"],
          "AdministrativeSupervisor": ["jobOrder", "purchaseOrder", "payOrder"],
          "GeneralSupervisor": ["jobOrder", "purchaseOrder", "payOrder", "maintananceOrder", "missionOrder"],
          "TransportSupervisor": ["jobOrder", "maintananceOrder"],
          "PatrolsSupervisor": ["jobOrder", "maintananceOrder"],
          "WorkshopSupervisor": ["jobOrder", "maintananceOrder"],
          "HospitalManager": ["jobOrder", "purchaseOrder", "payOrder"],
          "GeneralManager": ["jobOrder", "purchaseOrder", "payOrder", "maintananceOrder", "missionOrder"],
          "Driver": [],
          "Observer": ["jobOrder"]
        };
        
        // Add English role names for compatibility
        rolePermissions["Admin"] = ["jobOrder", "purchaseOrder", "payOrder", "maintananceOrder", "missionOrder"];
        rolePermissions["SuperUser"] = ["jobOrder", "purchaseOrder", "payOrder", "maintananceOrder", "missionOrder"];
        rolePermissions["Secretary"] = ["jobOrder", "missionOrder"];
        rolePermissions["AdministrativeSupervisor"] = ["jobOrder", "purchaseOrder", "payOrder"];
        rolePermissions["GeneralSupervisor"] = ["jobOrder", "purchaseOrder", "payOrder", "maintananceOrder", "missionOrder"];
        rolePermissions["TransportSupervisor"] = ["jobOrder", "maintananceOrder"];
        rolePermissions["PatrolsSupervisor"] = ["jobOrder", "maintananceOrder"];
        rolePermissions["WorkshopSupervisor"] = ["jobOrder", "maintananceOrder"];
        rolePermissions["HospitalManager"] = ["jobOrder", "purchaseOrder", "payOrder"];
        rolePermissions["GeneralManager"] = ["jobOrder", "purchaseOrder", "payOrder", "maintananceOrder", "missionOrder"];
        rolePermissions["Driver"] = [];
        rolePermissions["Observer"] = ["jobOrder"];
        
        // Get all application cards
        const applicationCards = document.querySelectorAll('.application-card');
        
        applicationCards.forEach(card => {
          const cardId = card.id;
          const userPermissions = rolePermissions[userRole] || [];
          
          if (!userPermissions.includes(cardId)) {
            // Disable card for unauthorized users
            card.style.opacity = '0.6';
            card.style.cursor = 'not-allowed';
            card.style.filter = 'grayscale(0.3)';
            
            // Update badge to show restricted access
            const badge = card.querySelector('.card-badge');
            if (badge && !badge.classList.contains('active')) {
              badge.textContent = 'ุบูุฑ ูุณููุญ';
              badge.style.background = '#dc3545';
            }
            
            // Remove hover effect
            card.addEventListener('mouseenter', function() {
              card.style.transform = 'none';
              card.style.boxShadow = 'none';
              card.style.borderColor = '#e9ecef';
            });
            
            // Remove click functionality
            card.onclick = function(e) {
              e.preventDefault();
              alert(`ุนุฐุฑุงูุ ุบูุฑ ูุณููุญ ูู ุจุงููุตูู ุฅูู ${card.querySelector('.card-title').textContent}. ุชุญุชุงุฌ ุตูุงุญูุงุช ุฃุนูู ูููุตูู ููุฐู ุงูุฎุฏูุฉ.`);
            };
          } else if (cardId !== 'jobOrder') {
            // Other applications - show coming soon message
            card.onclick = function() {
              alert(`${card.querySelector('.card-title').textContent} ููุฏ ุงูุชุทููุฑ ุญุงููุงู. ุณูุชู ุฅุชุงุญุฉ ูุฐู ุงูุฎุฏูุฉ ูุฑูุจุงู.`);
            };
          }
        });
      });
    </script>
  </body>
</html>
